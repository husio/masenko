client-a send PUSH {"name": "first", "deadqueue": "dead", "retry": 1}
client-a recv OK {"id":1}

client-a send PUSH {"name": "second", "blocked_by":[1], "deadqueue": "dead"}
client-a recv OK {"id":2}

# Nested blocking.
client-a send PUSH {"name": "third", "blocked_by":[2], "deadqueue": "dead"}
client-a recv OK {"id":3}
client-a send PUSH {"name": "fourth", "blocked_by":[2, 3], "deadqueue": "dead"}
client-a recv OK {"id":4}

client-a send FETCH
client-a recv OK {"id":1,"queue":"default","name":"first"}

client-a send NACK {"id": 1}
client-a recv OK {}

client-a send FETCH
client-a recv OK {"id":1,"queue":"default","name":"first","failures":1}

client-a send NACK {"id": 1}
client-a recv OK {}

# The only available task should be moved to the deadqueue.
client-a send FETCH
client-a recv EMPTY {}

client-a send FETCH {"queues": ["dead"]}
client-a recv OK {"id":1,"queue":"dead","name":"first"}

# Second task is no longer blocked by the first one in the dead queue.
client-a send FETCH {"queues": ["dead"]}
client-a recv OK {"id":2,"queue":"dead","name":"second"}

# Third task is failed as an indirect reference to first task.
client-a send FETCH {"queues": ["dead"]}
client-a recv OK {"id":3,"queue":"dead","name":"third"}

# Fourth task is failed as an indirect reference to first task.
client-a send FETCH {"queues": ["dead"]}
client-a recv OK {"id":4,"queue":"dead","name":"fourth"}

client-a send FETCH
client-a recv EMPTY {}
