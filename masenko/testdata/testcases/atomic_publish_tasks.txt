client-a send ATOMIC
client-a send PUSH {"name": "first"}
client-a send PUSH {"name": "second"}
client-a send PUSH {"name": "third"}
client-a send DONE
client-a recv OK {}

client-a send INFO
client-a recv OK {"queues":[{"name":"default","ready":3,"delayed":0,"to_ack":0}],"metrics":{"ack":0,"clients":1,"fetch":0,"nack":0,"push":3,"request":1,"request-error":0}}

client-a send FETCH
client-a recv OK {"id":1,"queue":"default","name":"first"}

client-a send FETCH
client-a recv OK {"id":2,"queue":"default","name":"second"}

client-a send FETCH
client-a recv OK {"id":3,"queue":"default","name":"third"}


# Executing an atomic operation that failed must not change state.
client-a send ATOMIC
client-a send PUSH {"name": "fourth"}
client-a send PUSH {"name": "fifth"}
client-a send XXX
client-a send DONE
client-a recv ERR {"msg":"XXX is not allowed in transaction."}

client-a send INFO
client-a recv OK {"queues":[{"name":"default","ready":0,"delayed":0,"to_ack":3}],"metrics":{"ack":0,"clients":1,"fetch":3,"nack":0,"push":3,"request":6,"request-error":1}}

client-a send QUIT
client-a recv OK {}
